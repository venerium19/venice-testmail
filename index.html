<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Speech Analyzer</title>
    <style>
      /* CSS for form styling */
      body,
      html {
        height: 100%;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        background-image: url("rm218-bb-07.jpg");
      }

      form {
        max-width: 400px; /* Set maximum width for the form */
        margin: 0 auto; /* Center the form horizontally */
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }

      label {
        font-size: 1.3em;
        font-weight: bold;
        color: #fff;
        display: block; /* Ensure labels are displayed as block elements */
        margin-bottom: 10px; /* Add spacing between labels and inputs */
      }

      input[type="text"],
      input[type="email"],
      button {
        width: 100%; /* Make input fields and buttons full width */
        padding: 10px;
        margin-bottom: 15px; /* Add spacing between input fields */
        border: 1px solid #ccc;
        border-radius: 3px;
        box-sizing: border-box; /* Ensure padding and border are included in width */
      }

      button {
        background-color: #007bff;
        color: #fff;
        cursor: pointer;
      }

      button:hover {
        background-color: #0056b3;
      }

      #testMessage {
        margin-top: 20px; /* Add spacing above the test message */
      }
    </style>
  </head>
  <body>
    <form>
      <label for="fname">Full name:</label><br />
      <input type="text" id="fname" name="Name" /><br />
      <label for="email">Email:</label><br />
      <input type="email" id="email" name="Email" /><br />

      <button
        type="button"
        id="toggleSpeech"
        onclick="toggleSpeechRecognition()"
      >
        Start Speaking
      </button>
    </form>

    <p id="testMessage"></p>
    <script
      type="text/javascript"
      src="https://cdn.emailjs.com/dist/email.min.js"
    ></script>

    <script type="text/javascript">
      (function () {
        emailjs.init("jvUN4lI-1KfaYkbs1"); // Initialize EmailJS with your user ID
      })();

      var recognition = new (window.SpeechRecognition ||
        window.webkitSpeechRecognition ||
        window.mozSpeechRecognition ||
        window.msSpeechRecognition)();

      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 5;

      var recognitionActive = false;

      recognition.onresult = function (event) {
        var transcript = event.results[0][0].transcript;
        console.log("You said: ", transcript);

        // Retrieve values from input fields
        var name = document.getElementById("fname").value;
        var email_add = document.getElementById("email").value;

        // Send the transcript via EmailJS
        var templateParams = {
          message: transcript,
          from_name: name,
          email_add: email_add,
        };

        emailjs
          .send("service_b3kszxr", "template_459hiem", templateParams)
          .then(
            function (response) {
              document.getElementById("testMessage").innerHTML = transcript;
              console.log("Email sent successfully:", response);
              alert("Email sent successfully!");
            },
            function (error) {
              document.getElementById("testMessage").innerHTML =
                "Error sending email";
              console.error("Email sending failed:", error);
              alert("Something went wrong!");
            }
          );
      };

      // Function to toggle speech recognition
      function toggleSpeechRecognition() {
        if (!recognitionActive) {
          alert(
            "To use the Speech Analyze AI, we're asking you to allow the usage of microphone"
          );
          recognition.start();
          recognitionActive = true;
          document.getElementById("toggleSpeech").textContent = "Stop Speaking";
          console.log("Listening for speech...");
        } else {
          recognition.stop();
          recognitionActive = false;
          document.getElementById("toggleSpeech").textContent =
            "Start Speaking";
          console.log("Speech recognition stopped.");
        }
      }
    </script>
  </body>
</html>
